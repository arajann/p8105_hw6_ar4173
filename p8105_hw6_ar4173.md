p8105\_hw6\_ar4173
================
Anand Rajan
12/2/2021

## Problem 1

Importing Data and Checking Missing Data

``` r
birthweight =
  read_csv(file = "./data/birthweight.csv")
```

    ## Rows: 4342 Columns: 20

    ## -- Column specification --------------------------------------------------------
    ## Delimiter: ","
    ## dbl (20): babysex, bhead, blength, bwt, delwt, fincome, frace, gaweeks, malf...

    ## 
    ## i Use `spec()` to retrieve the full column specification for this data.
    ## i Specify the column types or set `show_col_types = FALSE` to quiet this message.

Data Cleaning

``` r
birthweight_df =
birthweight %>% 
  mutate(babysex = factor(babysex,
                          levels = c(1, 2),
                          labels = c("male", "female"))) %>% 
  mutate(frace = factor(frace,
                        levels = c(1, 2, 3, 4, 8, 9),
                        labels = c("White", "Black", "Asian", "Puerto Rican", "Other", "Unknown"))) %>% 
  mutate(malform = factor(malform,
                          levels = c(0, 1),
                          labels = c("abset", "present"))) %>% 
  mutate(mrace = factor(mrace,
                        levels = c(1, 2, 3, 4, 8),
                        labels = c("White", "Black", "Asian", "Puerto Rican", "Other")))

str(birthweight_df)
```

    ## spec_tbl_df [4,342 x 20] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
    ##  $ babysex : Factor w/ 2 levels "male","female": 2 1 2 1 2 1 2 2 1 1 ...
    ##  $ bhead   : num [1:4342] 34 34 36 34 34 33 33 33 36 33 ...
    ##  $ blength : num [1:4342] 51 48 50 52 52 52 46 49 52 50 ...
    ##  $ bwt     : num [1:4342] 3629 3062 3345 3062 3374 ...
    ##  $ delwt   : num [1:4342] 177 156 148 157 156 129 126 140 146 169 ...
    ##  $ fincome : num [1:4342] 35 65 85 55 5 55 96 5 85 75 ...
    ##  $ frace   : Factor w/ 6 levels "White","Black",..: 1 2 1 1 1 1 2 1 1 2 ...
    ##  $ gaweeks : num [1:4342] 39.9 25.9 39.9 40 41.6 ...
    ##  $ malform : Factor w/ 2 levels "abset","present": 1 1 1 1 1 1 1 1 1 1 ...
    ##  $ menarche: num [1:4342] 13 14 12 14 13 12 14 12 11 12 ...
    ##  $ mheight : num [1:4342] 63 65 64 64 66 66 72 62 61 64 ...
    ##  $ momage  : num [1:4342] 36 25 29 18 20 23 29 19 13 19 ...
    ##  $ mrace   : Factor w/ 5 levels "White","Black",..: 1 2 1 1 1 1 2 1 1 2 ...
    ##  $ parity  : num [1:4342] 3 0 0 0 0 0 0 0 0 0 ...
    ##  $ pnumlbw : num [1:4342] 0 0 0 0 0 0 0 0 0 0 ...
    ##  $ pnumsga : num [1:4342] 0 0 0 0 0 0 0 0 0 0 ...
    ##  $ ppbmi   : num [1:4342] 26.3 21.3 23.6 21.8 21 ...
    ##  $ ppwt    : num [1:4342] 148 128 137 127 130 115 105 119 105 145 ...
    ##  $ smoken  : num [1:4342] 0 0 1 10 1 0 0 0 0 4 ...
    ##  $ wtgain  : num [1:4342] 29 28 11 30 26 14 21 21 41 24 ...
    ##  - attr(*, "spec")=
    ##   .. cols(
    ##   ..   babysex = col_double(),
    ##   ..   bhead = col_double(),
    ##   ..   blength = col_double(),
    ##   ..   bwt = col_double(),
    ##   ..   delwt = col_double(),
    ##   ..   fincome = col_double(),
    ##   ..   frace = col_double(),
    ##   ..   gaweeks = col_double(),
    ##   ..   malform = col_double(),
    ##   ..   menarche = col_double(),
    ##   ..   mheight = col_double(),
    ##   ..   momage = col_double(),
    ##   ..   mrace = col_double(),
    ##   ..   parity = col_double(),
    ##   ..   pnumlbw = col_double(),
    ##   ..   pnumsga = col_double(),
    ##   ..   ppbmi = col_double(),
    ##   ..   ppwt = col_double(),
    ##   ..   smoken = col_double(),
    ##   ..   wtgain = col_double()
    ##   .. )
    ##  - attr(*, "problems")=<externalptr>

Model Building

Included the following models in my model as I hypothesized they would
have an impact on the baby’s birth weight

gaweeks: Gestational Age in Weeks, I hypothesize that the longer the
gestational age is the greater the baby birthweight momage: Mother’s age
at delivery(years), I hypothesize that as the age of the mother
increases, the baby’s birthweight decreases malform: Presence of
malformations that could affect weight (0 = absent, 1 = present), I
hypothesize that the presence of malformations will decrease the baby’s
birthweighth on average smoken: average number of cigarettes smoked per
day during pregnancy, I hypothesize that the greater the average number
of smoked ciagrettes per day, the lower the baby birthweight
smoken\*malform: Interaction term between average number of cigarettes
smoked and presence of malformations, I hypoethsize the interaction is
significant

``` r
fit_mod= lm(bwt ~ gaweeks +  momage + malform + smoken + (smoken*malform), data = birthweight_df )
fit_mod %>% broom::tidy()
```

    ## # A tibble: 6 x 5
    ##   term                  estimate std.error statistic   p.value
    ##   <chr>                    <dbl>     <dbl>     <dbl>     <dbl>
    ## 1 (Intercept)             285.      92.0        3.10 1.92e-  3
    ## 2 gaweeks                  65.8      2.24      29.4  1.53e-173
    ## 3 momage                   12.9      1.82       7.05 2.04e- 12
    ## 4 malformpresent          237.     154.         1.54 1.23e-  1
    ## 5 smoken                   -6.61     0.953     -6.94 4.65e- 12
    ## 6 malformpresent:smoken   -23.4     11.6       -2.02 4.39e-  2

``` r
fit_mod %>% 
  broom::glance()
```

    ## # A tibble: 1 x 12
    ##   r.squared adj.r.squared sigma statistic   p.value    df  logLik    AIC    BIC
    ##       <dbl>         <dbl> <dbl>     <dbl>     <dbl> <dbl>   <dbl>  <dbl>  <dbl>
    ## 1     0.188         0.187  462.      201. 3.56e-193     5 -32796. 65606. 65651.
    ## # ... with 3 more variables: deviance <dbl>, df.residual <int>, nobs <int>

``` r
fixed_mod = lm(bwt ~ blength + gaweeks, data=birthweight_df)
interaction_mod = lm(bwt ~ bhead + blength + babysex + bhead*blength + bhead*babysex + blength*babysex, data=birthweight_df)
```

From analyzing the p-values and model coefficients, the predictor
variables are significant with the exception of malformpresent.
Malformpresent was the only variable that did not have a significant
p-value (p-value = 0.1225)

Now lets evaluate the residuals

``` r
birthweight_df %>% 
  add_predictions(fit_mod) %>% 
  add_residuals(fit_mod) %>% 
  ggplot(aes(x=pred, y=resid)) +
  geom_point()  +
  geom_smooth(method= "lm", se = FALSE)
```

    ## `geom_smooth()` using formula 'y ~ x'

![](p8105_hw6_ar4173_files/figure-gfm/unnamed-chunk-4-1.png)<!-- -->

From looking at the graph we see that the residuals are randomly
scattered and do not have a definitive trend. Thus

Now lets compare the created model to the other two models

``` r
set.seed(7777)

cv_df =
  crossv_mc(birthweight_df, n=4342, test = 0.2) %>% 
  mutate(
    train = map(train, as_tibble),
    test = map(test, as_tibble)) %>% 
  mutate(
    fit_mod  = map(train, ~lm(bwt ~ gaweeks +  momage + malform + smoken + (smoken*malform), data = birthweight_df )),
    fixed_mod  = map(train, ~lm(bwt ~ blength + gaweeks, data=birthweight_df)),
    interaction_mod = map(train, ~lm(bwt ~ bhead + blength + babysex + bhead*blength + bhead*babysex + blength*babysex, data=birthweight_df))) %>% 
  mutate(
    rmse_fit = map2_dbl(fit_mod, test, ~rmse(model = .x, data = .y)),
    rmse_fixed = map2_dbl(fixed_mod, test, ~rmse(model = .x, data = .y)),
    rmse_interaction = map2_dbl(interaction_mod, test, ~rmse(model = .x, data = .y)))
```

``` r
cv_df %>% 
  select(starts_with("rmse")) %>% 
  pivot_longer(
    everything(),
    names_to = "model", 
    values_to = "rmse",
    names_prefix = "rmse_") %>% 
  mutate(model = fct_inorder(model)) %>% 
  ggplot(aes(x = model, y = rmse)) + geom_boxplot()
```

![](p8105_hw6_ar4173_files/figure-gfm/unnamed-chunk-6-1.png)<!-- -->

## Problem 2

Importing Dataset

``` r
weather_df = 
  rnoaa::meteo_pull_monitors(
    c("USW00094728"),
    var = c("PRCP", "TMIN", "TMAX"), 
    date_min = "2017-01-01",
    date_max = "2017-12-31") %>%
  mutate(
    name = recode(id, USW00094728 = "CentralPark_NY"),
    tmin = tmin / 10,
    tmax = tmax / 10) %>%
  select(name, id, everything())
```

    ## Registered S3 method overwritten by 'hoardr':
    ##   method           from
    ##   print.cache_info httr

    ## using cached file: C:\Users\araja\AppData\Local/Cache/R/noaa_ghcnd/USW00094728.dly

    ## date created (size, mb): 2021-10-07 02:26:40 (7.617)

    ## file min/max dates: 1869-01-01 / 2021-10-31

Bootstrapping Dataset

``` r
bootstrap_weather =
  bootstrap(weather_df, 5000) 

as_data_frame(bootstrap_weather$strap[[1]])
```

    ## Warning: `as_data_frame()` was deprecated in tibble 2.0.0.
    ## Please use `as_tibble()` instead.
    ## The signature and semantics have changed, see `?as_tibble`.
    ## This warning is displayed once every 8 hours.
    ## Call `lifecycle::last_warnings()` to see where this warning was generated.

    ## # A tibble: 365 x 6
    ##    name           id          date        prcp  tmax  tmin
    ##    <chr>          <chr>       <date>     <dbl> <dbl> <dbl>
    ##  1 CentralPark_NY USW00094728 2017-09-14     5  27.2  21.1
    ##  2 CentralPark_NY USW00094728 2017-02-08     8  16.7   3.3
    ##  3 CentralPark_NY USW00094728 2017-01-22    13   8.9   6.1
    ##  4 CentralPark_NY USW00094728 2017-04-22    28  13.9   9.4
    ##  5 CentralPark_NY USW00094728 2017-07-13     0  32.2  22.8
    ##  6 CentralPark_NY USW00094728 2017-09-21     0  26.7  21.7
    ##  7 CentralPark_NY USW00094728 2017-10-20     0  22.8  13.9
    ##  8 CentralPark_NY USW00094728 2017-11-28     0  12.2   2.2
    ##  9 CentralPark_NY USW00094728 2017-04-16     0  30.6  15  
    ## 10 CentralPark_NY USW00094728 2017-08-07   193  21.7  17.8
    ## # ... with 355 more rows

``` r
bootstrap_results=
bootstrap_weather %>% 
  mutate(
    models = map(strap, ~lm(tmax ~ tmin, data=.x)),
    results = map(models, broom::tidy),
    glance = map(models, broom::glance))
```
